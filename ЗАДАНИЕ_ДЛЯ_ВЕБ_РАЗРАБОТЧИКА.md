# Техническое задание: Веб-консоль Service Booking

**Кому:** Разработчик веб-консоли  
**От:** iOS-разработчик  
**Дата:** Февраль 2025

---

## 1. Цель

Нужна **веб-консоль** с серверной частью (backend), к которой подключается мобильное iOS-приложение. Серверная часть и REST API — **внутри веб-консоли**, отдельного backend-проекта нет.

**iOS-приложение уже готово** и ожидает работу по этому API.

---

## 2. Архитектура

```
┌─────────────────────────────────────────────────────────────────┐
│                     ВЕБ-КОНСОЛЬ                                  │
│  ┌──────────────────────┐    ┌──────────────────────────────┐   │
│  │  Админ-панель (Web)  │◄──►│  REST API (Backend)          │   │
│  │  - Услуги, записи    │    │  - База данных               │   │
│  │  - Клиенты, посты    │    │  - Все эндпоинты ниже        │   │
│  │  - QR для подключения│    │  - Авторизация Bearer        │   │
│  └──────────────────────┘    └──────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                                        ▲
                                        │ HTTPS / JSON
                                        │
                               ┌────────┴────────┐
                               │  iOS-приложение │
                               │  (готово)       │
                               └─────────────────┘
```

---

## 3. REST API — обязательные эндпоинты

**Базовый URL:** `https://ваш-домен.com/api/v1` (или аналогичный)

**Формат:** JSON, UTF-8  
**Даты:** ISO 8601 (например `2025-01-31T14:30:00Z`)  
**Ключи:** snake_case (`service_id`, `created_at` и т.д.)

### 3.1 Регистрация устройства (без авторизации)

| Метод | Эндпоинт | Описание |
|-------|----------|----------|
| POST | `/clients/register` | Регистрация устройства, выдача API-ключа |

**Запрос:**
```json
{
  "device_id": "UUID-от-iOS",
  "platform": "iOS 17.0",
  "app_version": "1.0"
}
```

**Ответ 200:**
```json
{
  "client_id": "usr_1234567890",
  "api_key": "abc123def456..."
}
```

- Сервер создаёт клиента по `device_id` (или находит существующего)
- Возвращает уникальный `api_key` — он используется во всех последующих запросах

---

### 3.2 Авторизация

Все остальные запросы требуют заголовок:
```
Authorization: Bearer {api_key}
Content-Type: application/json
```

401 — если ключ неверный или отсутствует.

---

### 3.3 Услуги

| Метод | Эндпоинт |
|-------|----------|
| GET | `/services` |
| GET | `/services/:id` |

**Ответ (массив/объект):**
```json
{
  "_id": "svc_1",
  "name": "Химчистка салона",
  "description": "Полная химчистка",
  "price": 5000,
  "duration": 60,
  "category": "Чистка",
  "image_url": null,
  "is_active": true
}
```

- `duration` — минуты
- `is_active: false` — не показывать в приложении

---

### 3.4 Посты (боксы автомойки)

| Метод | Эндпоинт |
|-------|----------|
| GET | `/posts` |

**Ответ (массив):**
```json
[
  {
    "_id": "post_1",
    "name": "Пост 1",
    "is_enabled": true,
    "use_custom_hours": false,
    "start_time": "09:00",
    "end_time": "18:00",
    "interval_minutes": 30
  }
]
```

---

### 3.5 Слоты времени

| Метод | Эндпоинт |
|-------|----------|
| GET | `/slots?service_id=svc_1&date=2026-02-01&post_id=post_1` |

**Ответ (массив):**
```json
[
  { "time": "2026-02-01T09:00:00.000Z", "is_available": true },
  { "time": "2026-02-01T09:30:00.000Z", "is_available": false }
]
```

- `date` — YYYY-MM-DD
- `time` — UTC, ISO 8601
- Показывать слоты в рамках рабочих часов поста

---

### 3.6 Бронирования

| Метод | Эндпоинт |
|-------|----------|
| GET | `/bookings` |
| POST | `/bookings` |
| DELETE | `/bookings/:id` |

**POST /bookings (тело):**
```json
{
  "service_id": "svc_1",
  "date_time": "2026-02-01T09:30:00.000Z",
  "post_id": "post_1",
  "notes": "Комментарий или null"
}
```

**Ответ (объект):**
```json
{
  "_id": "bkg_1",
  "service_id": "svc_1",
  "service_name": "Химчистка салона",
  "user_id": "usr_123",
  "date_time": "2026-02-01T09:30:00.000Z",
  "status": "pending",
  "price": 5000,
  "duration": 60,
  "notes": null,
  "created_at": "2026-01-31T12:00:00Z"
}
```

**Статусы:** `pending`, `confirmed`, `in_progress`, `completed`, `cancelled`

---

### 3.7 Профиль пользователя

| Метод | Эндпоинт |
|-------|----------|
| GET | `/profile` |
| PUT | `/profile` |

**Ответ GET:**
```json
{
  "_id": "usr_123",
  "first_name": "Иван",
  "last_name": "Петров",
  "phone": "+7 999 123-45-67",
  "email": "ivan@mail.ru",
  "avatar_url": null,
  "social_links": {
    "telegram": "@ivan",
    "whatsapp": "+79991234567",
    "instagram": null,
    "vk": null
  },
  "created_at": "2026-01-31T12:00:00Z"
}
```

**PUT (тело):** те же поля, что можно редактировать.

---

## 4. QR-код для подключения

В настройках веб-консоли должен быть раздел **«Подключение приложения»** с QR-кодом.

QR содержит **только URL** API, например:
```
https://ваш-домен.com/api/v1
```

Или JSON:
```json
{"base_url": "https://ваш-домен.com/api/v1"}
```

Клиент сканирует QR → приложение подключается к этому URL и вызывает `POST /clients/register`.

---

## 5. Админ-панель (функции)

- **Услуги:** CRUD, категории, цены, длительность
- **Посты:** настройка боксов, рабочих часов, интервалов
- **Записи:** список, фильтры, смена статуса, отмена
- **Клиенты:** список, профиль, история записей
- **Настройки:** базовый URL, генерация QR
- **Слоты:** генерация по расписанию постов и существующим бронированиям

---

## 6. Технические требования

- HTTPS
- CORS для мобильных клиентов
- Таймаут 30 сек
- Ошибки 4xx/5xx — JSON с описанием

---

## 7. Проверка

После развёртывания можно проверить:

```bash
# Регистрация
curl -X POST https://ваш-домен.com/api/v1/clients/register \
  -H "Content-Type: application/json" \
  -d '{"device_id":"test-uuid-123","platform":"iOS 17.0","app_version":"1.0"}'

# Ожидается: {"client_id":"...", "api_key":"..."}
```

Далее все запросы — с заголовком `Authorization: Bearer {api_key}`.

---

## 8. Контакт

При расхождениях по форматам или необходимости дополнительных полей — обращаться к iOS-разработчику.

**iOS-приложение готово и ждёт рабочий API.**
